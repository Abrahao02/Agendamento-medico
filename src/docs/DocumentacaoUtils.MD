# ðŸ“š DocumentaÃ§Ã£o Completa - Utils do Projeto

> **VersÃ£o:** 2.1  
> **Ãšltima atualizaÃ§Ã£o:** Janeiro 2026  
> **Total de Utils:** 26 funÃ§Ãµes

---

## ðŸ“‹ Ãndice

1. [WhatsApp Utils](#-whatsapp-utils) âœ¨ NOVO
2. [FormataÃ§Ã£o](#-formataÃ§Ã£o)
3. [ValidaÃ§Ãµes](#-validaÃ§Ãµes)
4. [Filtros de Data](#-filtros-de-data)
5. [Filtros de Appointments](#-filtros-de-appointments)
6. [Filtros de Availability](#-filtros-de-availability)
7. [Agrupamento](#-agrupamento)
8. [EstatÃ­sticas](#-estatÃ­sticas)
9. [Helpers de Pacientes](#-helpers-de-pacientes) âœ¨ NOVO
10. [Helpers de Appointments](#-helpers-de-appointments) âœ¨ NOVO
11. [Helpers de Mensagens](#-helpers-de-mensagens) âœ¨ NOVO
12. [Helpers Gerais](#-helpers-gerais)

---

## ðŸ“± WhatsApp Utils

### `cleanWhatsapp(value)` âœ¨ NOVO
**Arquivo**: `src/utils/whatsapp/cleanWhatsapp.js`

Remove toda formataÃ§Ã£o do WhatsApp, retornando apenas nÃºmeros.

```javascript
import { cleanWhatsapp } from "@/utils/whatsapp/cleanWhatsapp";

cleanWhatsapp("(11) 98765-4321");
// âžœ "11987654321"

cleanWhatsapp("11 9 8765 4321");
// âžœ "11987654321"

cleanWhatsapp("abc11987xyz");
// âžœ "11987"

cleanWhatsapp("");
// âžœ ""
```

**ParÃ¢metros:**
- `value` (string): NÃºmero com ou sem formataÃ§Ã£o

**Retorna:** `string` - Apenas nÃºmeros (sem limite de tamanho)

**Uso nos Hooks:**
- `usePatients` (3 vezes)
- `useAgenda`
- `usePublicSchedule`
- `useRegister`

---

### `validateWhatsappLength(whatsapp)` âœ¨ NOVO
**Arquivo**: `src/utils/whatsapp/validateWhatsappLength.js`

Valida se o WhatsApp tem comprimento vÃ¡lido (10-11 dÃ­gitos).

```javascript
import { validateWhatsappLength } from "@/utils/whatsapp/validateWhatsappLength";

validateWhatsappLength("11987654321");
// âžœ { valid: true, length: 11 }

validateWhatsappLength("1234567890");
// âžœ { valid: true, length: 10 }

validateWhatsappLength("123456789");
// âžœ { 
//   valid: false, 
//   length: 9, 
//   message: "WhatsApp invÃ¡lido. Digite DDD + nÃºmero (10 a 11 dÃ­gitos)." 
// }
```

**ParÃ¢metros:**
- `whatsapp` (string): NÃºmero apenas com dÃ­gitos

**Retorna:** `Object`
```typescript
{
  valid: boolean,
  length: number,
  message?: string  // Apenas quando valid = false
}
```

---

### `formatWhatsapp(value)`
**Arquivo**: `src/utils/formatter/formatWhatsapp.js`

Formata um nÃºmero de telefone no padrÃ£o brasileiro.

```javascript
import { formatWhatsapp } from "@/utils/formatter/formatWhatsapp";

formatWhatsapp("11987654321");
// âžœ "(11) 98765-4321"

formatWhatsapp("1198765");
// âžœ "(11) 98765"

formatWhatsapp("11");
// âžœ "11"
```

**ParÃ¢metros:**
- `value` (string): NÃºmero de telefone com ou sem formataÃ§Ã£o

**Retorna:** `string` - NÃºmero formatado como `(XX) XXXXX-XXXX`

**Regras:**
- Remove todos os caracteres nÃ£o numÃ©ricos
- Limita a 11 dÃ­gitos
- Formata progressivamente conforme digitaÃ§Ã£o

---

## ðŸŽ¨ FormataÃ§Ã£o

### `formatDate(input)`
**Arquivo**: `src/utils/formatter/formatDate.js`

Converte datas de diversos formatos para o padrÃ£o brasileiro DD/MM/YYYY.

```javascript
import formatDate from "@/utils/formatter/formatDate";

// ISO string
formatDate("2026-01-15");
// âžœ "15/01/2026"

// Date object
formatDate(new Date(2026, 0, 15));
// âžœ "15/01/2026"

// Timestamp
formatDate(1736899200000);
// âžœ "15/01/2026"

// Valores invÃ¡lidos
formatDate(null);     // âžœ ""
formatDate("texto");  // âžœ "texto"
```

**ParÃ¢metros:**
- `input` (string | Date | number | null | undefined): Data em qualquer formato

**Retorna:** `string` - Data formatada como `DD/MM/YYYY`

**Casos Suportados:**
- âœ… ISO string (`YYYY-MM-DD`)
- âœ… Date object
- âœ… Timestamp (nÃºmero)
- âœ… ISO completo (`YYYY-MM-DDTHH:mm:ss.sssZ`)
- âš ï¸ Retorna string vazia para `null` ou `undefined`
- âš ï¸ Retorna a prÃ³pria string se nÃ£o conseguir converter

---

## âœ… ValidaÃ§Ãµes

### `validateFormField(field, value, rules)` âœ¨ NOVO
**Arquivo**: `src/utils/validators/formValidation.js`

Validador universal para campos de formulÃ¡rio com mÃºltiplas regras.

```javascript
import { validateFormField } from "@/utils/validators/formValidation";

// Nome obrigatÃ³rio
validateFormField("name", "", { required: true });
// âžœ { valid: false, error: "Name Ã© obrigatÃ³rio." }

validateFormField("name", "JoÃ£o Silva", { required: true });
// âžœ { valid: true }

// Email vÃ¡lido
validateFormField("email", "invalid", { required: true, email: true });
// âžœ { valid: false, error: "Email invÃ¡lido." }

validateFormField("email", "user@example.com", { required: true, email: true });
// âžœ { valid: true }

// WhatsApp
validateFormField("whatsapp", "11987654321", { required: true, whatsapp: true });
// âžœ { valid: true }

// Senhas iguais
validateFormField("confirmPassword", "123", { 
  required: true, 
  match: { value: "456", message: "As senhas nÃ£o coincidem." }
});
// âžœ { valid: false, error: "As senhas nÃ£o coincidem." }

// Comprimento mÃ­nimo
validateFormField("password", "123", { minLength: 8 });
// âžœ { valid: false, error: "MÃ­nimo de 8 caracteres." }

// PadrÃ£o customizado
validateFormField("cpf", "123", { 
  pattern: /^\d{11}$/ 
});
// âžœ { valid: false, error: "Formato invÃ¡lido." }

// ValidaÃ§Ã£o customizada
validateFormField("age", "15", {
  custom: (value) => {
    const age = Number(value);
    if (age < 18) {
      return { valid: false, error: "Deve ser maior de 18 anos." };
    }
    return { valid: true };
  }
});
```

**ParÃ¢metros:**
- `field` (string): Nome do campo
- `value` (any): Valor do campo
- `rules` (Object): Regras de validaÃ§Ã£o

**Rules DisponÃ­veis:**
```typescript
{
  required?: boolean,           // Campo obrigatÃ³rio
  email?: boolean,              // Valida formato de email
  whatsapp?: boolean,           // Valida WhatsApp (10-11 dÃ­gitos)
  match?: {                     // Valida igualdade (confirmaÃ§Ã£o)
    value: any,
    message?: string
  },
  minLength?: number,           // Comprimento mÃ­nimo
  maxLength?: number,           // Comprimento mÃ¡ximo
  pattern?: RegExp,             // Regex customizado
  custom?: (value) => Object    // ValidaÃ§Ã£o customizada
}
```

**Retorna:** `Object`
```typescript
{
  valid: boolean,
  error?: string  // Mensagem de erro quando valid = false
}
```

**Uso nos Hooks:**
- `useRegister` - ValidaÃ§Ã£o do formulÃ¡rio de registro
- `useLogin` - ValidaÃ§Ã£o do formulÃ¡rio de login

---

### `validatePassword(password)` & `isPasswordValid(criteria)`
**Arquivo**: `src/utils/validators/passwordValidation.js`

Valida critÃ©rios de senha forte.

```javascript
import { validatePassword, isPasswordValid } from "@/utils/validators/passwordValidation";

const criteria = validatePassword("Senha@123");
// âžœ {
//   length: true,     // >= 8 caracteres
//   uppercase: true,  // Tem maiÃºscula
//   lowercase: true,  // Tem minÃºscula
//   number: true,     // Tem nÃºmero
//   symbol: true      // Tem sÃ­mbolo
// }

isPasswordValid(criteria);
// âžœ true
```

**CritÃ©rios:**
| CritÃ©rio | DescriÃ§Ã£o | ValidaÃ§Ã£o |
|----------|-----------|-----------|
| `length` | MÃ­nimo 8 caracteres | `password.length >= 8` |
| `uppercase` | Pelo menos uma maiÃºscula | `/[A-Z]/` |
| `lowercase` | Pelo menos uma minÃºscula | `/[a-z]/` |
| `number` | Pelo menos um nÃºmero | `/\d/` |
| `symbol` | Pelo menos um sÃ­mbolo | `/[\W_]/` |

---

## ðŸ“… Filtros de Data

### `formatDateToQuery(date)`
**Arquivo**: `src/utils/filters/dateFilters.js`

Converte Date object para string YYYY-MM-DD.

```javascript
import { formatDateToQuery } from "@/utils/filters/dateFilters";

formatDateToQuery(new Date(2026, 0, 15));
// âžœ "2026-01-15"

formatDateToQuery(null);
// âžœ ""
```

**ParÃ¢metros:**
- `date` (Date): Data a formatar

**Retorna:** `string` - Data no formato `YYYY-MM-DD` ou string vazia

---

### `getTodayString()`
**Arquivo**: `src/utils/filters/dateFilters.js`

ObtÃ©m a data de hoje em formato YYYY-MM-DD.

```javascript
import { getTodayString } from "@/utils/filters/dateFilters";

getTodayString();
// âžœ "2026-01-10" (data atual)
```

**Retorna:** `string` - Data de hoje

---

### `extractYearMonth(dateStr)`
**Arquivo**: `src/utils/filters/dateFilters.js`

Extrai ano e mÃªs de uma string de data.

```javascript
import { extractYearMonth } from "@/utils/filters/dateFilters";

extractYearMonth("2026-01-15");
// âžœ { year: 2026, month: 1 }

extractYearMonth("15/01/2026");
// âžœ null (formato invÃ¡lido)
```

**ParÃ¢metros:**
- `dateStr` (string): Data no formato `YYYY-MM-DD`

**Retorna:** `{year: number, month: number} | null`

---

### `isDateInRange(date, startDate, endDate)`
**Arquivo**: `src/utils/filters/dateFilters.js`

Verifica se uma data estÃ¡ dentro de um intervalo.

```javascript
import { isDateInRange } from "@/utils/filters/dateFilters";

isDateInRange("2026-01-15", "2026-01-01", "2026-01-31");
// âžœ true

isDateInRange("2026-02-01", "2026-01-01", "2026-01-31");
// âžœ false

// Sem range definido = sempre true
isDateInRange("2026-01-15", "", "");
// âžœ true
```

**ParÃ¢metros:**
- `date` (string): Data a verificar (YYYY-MM-DD)
- `startDate` (string): Data inicial
- `endDate` (string): Data final

**Retorna:** `boolean`

---

### `isDateInMonthYear(dateStr, month, year)`
**Arquivo**: `src/utils/filters/dateFilters.js`

Verifica se uma data pertence a um mÃªs/ano especÃ­fico.

```javascript
import { isDateInMonthYear } from "@/utils/filters/dateFilters";

isDateInMonthYear("2026-01-15", 1, 2026);
// âžœ true

isDateInMonthYear("2026-02-15", 1, 2026);
// âžœ false
```

**ParÃ¢metros:**
- `dateStr` (string): Data a verificar (YYYY-MM-DD)
- `month` (number): MÃªs (1-12)
- `year` (number): Ano

**Retorna:** `boolean`

---

### `isFutureDate(dateStr)` / `isPastDate(dateStr)`
**Arquivo**: `src/utils/filters/dateFilters.js`

Verifica se uma data Ã© futura ou passada.

```javascript
import { isFutureDate, isPastDate } from "@/utils/filters/dateFilters";

// Assumindo hoje = 2026-01-10

isFutureDate("2026-01-15");  // âžœ true
isPastDate("2026-01-05");    // âžœ true
```

**ParÃ¢metros:**
- `dateStr` (string): Data a verificar (YYYY-MM-DD)

**Retorna:** `boolean`

---

## ðŸ” Filtros de Appointments

### `filterAppointments(appointments, config)`
**Arquivo**: `src/utils/filters/appointmentFilters.js`

Filtra appointments com mÃºltiplos critÃ©rios.

```javascript
import { filterAppointments } from "@/utils/filters/appointmentFilters";

const appointments = [
  { id: 1, date: "2026-01-15", status: "Confirmado", patientName: "JoÃ£o" },
  { id: 2, date: "2026-01-20", status: "Pendente", patientName: "Maria" }
];

// Por status
filterAppointments(appointments, { statusFilter: "Confirmado" });

// Por range
filterAppointments(appointments, {
  startDate: "2026-01-01",
  endDate: "2026-01-31"
});

// Por mÃªs/ano
filterAppointments(appointments, {
  selectedMonth: 1,
  selectedYear: 2026
});

// MÃºltiplos filtros
filterAppointments(appointments, {
  statusFilter: "Confirmado",
  searchTerm: "joÃ£o",
  futureOnly: true
});
```

**Config Options:**
```typescript
{
  statusFilter?: string,       // "Confirmado", "Pendente", "NÃ£o Compareceu", "Todos"
  searchTerm?: string,         // Busca em nome ou telefone
  startDate?: string,          // YYYY-MM-DD
  endDate?: string,            // YYYY-MM-DD
  selectedMonth?: number,      // 1-12
  selectedYear?: number,       // Ano
  futureOnly?: boolean,        // Apenas >= hoje
  specificDate?: string        // YYYY-MM-DD (prioridade mÃ¡xima)
}
```

**Retorna:** `Array` - Appointments filtrados

---

### `sortAppointments(appointments, ascending)`
**Arquivo**: `src/utils/filters/appointmentFilters.js`

Ordena appointments por data e hora.

```javascript
import { sortAppointments } from "@/utils/filters/appointmentFilters";

const appointments = [
  { date: "2026-01-20", time: "14:00" },
  { date: "2026-01-15", time: "08:00" }
];

sortAppointments(appointments);
// âžœ Ordenados: 15/08:00, 20/14:00

sortAppointments(appointments, false);
// âžœ Ordenados: 20/14:00, 15/08:00 (descendente)
```

**ParÃ¢metros:**
- `appointments` (Array)
- `ascending` (boolean): `true` (padrÃ£o) = ascendente

**Retorna:** `Array` - Nova array ordenada

---

## ðŸ“† Filtros de Availability

### `filterAvailableSlots(availability, appointments)`
**Arquivo**: `src/utils/filters/availabilityFilters.js`

Remove slots jÃ¡ agendados da disponibilidade.

```javascript
import { filterAvailableSlots } from "@/utils/filters/availabilityFilters";

const availability = [
  { date: "2026-01-15", slots: ["08:00", "09:00", "10:00"] }
];

const appointments = [
  { date: "2026-01-15", time: "09:00" }
];

filterAvailableSlots(availability, appointments);
// âžœ [{ date: "2026-01-15", slots: ["08:00", "10:00"] }]
```

**Retorna:** `Array` - Availability apenas com slots livres

---

### `validateAvailability(availability, futureOnly)`
**Arquivo**: `src/utils/filters/availabilityFilters.js`

Valida e filtra availability com critÃ©rios de qualidade.

```javascript
import { validateAvailability } from "@/utils/filters/availabilityFilters";

const availability = [
  { date: "2026-01-15", slots: ["08:00"] },
  { date: "2026-01-05", slots: ["10:00"] },  // Passada
  { date: "2026-01-20", slots: [] }          // Vazia
];

validateAvailability(availability);
// âžœ [{ date: "2026-01-15", slots: ["08:00"] }]
```

**ValidaÃ§Ãµes:**
- âœ… `date` existe e Ã© string
- âœ… `slots` Ã© array nÃ£o vazio
- âœ… `date >= hoje` (se futureOnly = true)

**Retorna:** `Array` - Ordenado por data

---

### `countAvailableSlots(availability)`
**Arquivo**: `src/utils/filters/availabilityFilters.js`

Conta total de slots disponÃ­veis.

```javascript
import { countAvailableSlots } from "@/utils/filters/availabilityFilters";

const availability = [
  { date: "2026-01-15", slots: ["08:00", "09:00", "10:00"] }
];

countAvailableSlots(availability);
// âžœ 3
```

---

### `getAvailableSlotsForDate(availability, appointments, date)`
**Arquivo**: `src/utils/filters/availabilityFilters.js`

ObtÃ©m slots livres para uma data especÃ­fica.

```javascript
import { getAvailableSlotsForDate } from "@/utils/filters/availabilityFilters";

getAvailableSlotsForDate(availability, appointments, "2026-01-15");
// âžœ ["08:00", "10:00"] (ordenados, sem agendados)
```

---

## ðŸ‘¥ Agrupamento

### `groupAppointmentsByPatient(appointments)`
**Arquivo**: `src/utils/filters/patientGrouping.js`

Agrupa appointments por paciente (WhatsApp).

```javascript
import { groupAppointmentsByPatient } from "@/utils/filters/patientGrouping";

const appointments = [
  {
    patientWhatsapp: "11987654321",
    patientName: "JoÃ£o Silva",
    referenceName: "JoÃ£o",
    value: 150,
    status: "Confirmado"
  },
  {
    patientWhatsapp: "11987654321",
    value: 150,
    status: "Pendente"
  }
];

groupAppointmentsByPatient(appointments);
// âžœ [
//   {
//     name: "JoÃ£o",
//     whatsapp: "11987654321",
//     appointments: [/* 2 appointments */],
//     totalValue: 300,
//     statusCounts: { Confirmado: 1, Pendente: 1 }
//   }
// ]
```

**Retorna:** `Array` - Pacientes ordenados por nome

---

## ðŸ“Š EstatÃ­sticas

### `calculateAppointmentStats(appointments, priceMap)`
**Arquivo**: `src/utils/stats/appointmentStats.js`

Calcula estatÃ­sticas de appointments.

```javascript
import { calculateAppointmentStats } from "@/utils/stats/appointmentStats";

const appointments = [
  { date: "2026-01-05", status: "Confirmado", patientWhatsapp: "11987654321", value: 150 }
];

const priceMap = {
  "11987654321": 150,
  "11988776655": 200
};

calculateAppointmentStats(appointments, priceMap);
// âžœ {
//   totalAppointments: 1,
//   attendedAppointments: 1,  // Confirmado e data <= hoje
//   totalRevenue: 150,
//   averageTicket: 175        // (150+200)/2
// }
```

---

### `calculateStatusSummary(appointments)`
**Arquivo**: `src/utils/stats/appointmentStats.js`

Calcula resumo por status.

```javascript
import { calculateStatusSummary } from "@/utils/stats/appointmentStats";

const appointments = [
  { status: "Confirmado" },
  { status: "Confirmado" },
  { status: "Pendente" }
];

calculateStatusSummary(appointments);
// âžœ { Confirmado: 2, Pendente: 1, "NÃ£o Compareceu": 0 }
```

---

## ðŸ§‘â€âš•ï¸ Helpers de Pacientes

### `generatePatientId(doctorId, whatsapp)` âœ¨ NOVO
**Arquivo**: `src/utils/patients/generatePatientId.js`

Gera ID Ãºnico para paciente.

```javascript
import { generatePatientId } from "@/utils/patients/generatePatientId";

generatePatientId("doc123", "(11) 98765-4321");
// âžœ "doc123_11987654321"

generatePatientId("doc123", "11 9 8765 4321");
// âžœ "doc123_11987654321"
```

**Uso nos Hooks:**
- `usePatients`
- `useAgenda`
- `usePublicSchedule`

---

### `calculatePatientStats(appointments, whatsapp)` âœ¨ NOVO
**Arquivo**: `src/utils/patients/calculatePatientStats.js`

Calcula estatÃ­sticas de um paciente especÃ­fico.

```javascript
import { calculatePatientStats } from "@/utils/patients/calculatePatientStats";

const appointments = [
  { patientWhatsapp: "11987654321", value: 150, status: "Confirmado" },
  { patientWhatsapp: "11987654321", value: 150, status: "Pendente" },
  { patientWhatsapp: "11987654321", value: 150, status: "Confirmado" }
];

calculatePatientStats(appointments, "11987654321");
// âžœ {
//   total: 3,
//   totalValue: 450,
//   confirmed: 2,
//   pending: 1,
//   noShow: 0
// }
```

**Retorna:** `Object`
```typescript
{
  total: number,          // Total de appointments
  totalValue: number,     // Soma dos valores
  confirmed: number,      // Status "Confirmado"
  pending: number,        // Status "Pendente"
  noShow: number          // Status "NÃ£o Compareceu"
}
```

---

## ðŸ“… Helpers de Appointments

### `getBookedSlotsForDate(appointments, date)` âœ¨ NOVO
**Arquivo**: `src/utils/appointments/getBookedSlots.js`

Retorna horÃ¡rios jÃ¡ agendados em uma data.

```javascript
import { getBookedSlotsForDate } from "@/utils/appointments/getBookedSlots";

const appointments = [
  { date: "2026-01-15", time: "08:00" },
  { date: "2026-01-15", time: "09:00" }
];

getBookedSlotsForDate(appointments, "2026-01-15");
// âžœ ["08:00", "09:00"] (ordenados)
```

**Uso nos Hooks:**
- `useAvailability`
- `usePublicSchedule`

---

### `hasAppointmentConflict(appointments, date, time)` âœ¨ NOVO
**Arquivo**: `src/utils/appointments/hasConflict.js`

Verifica se existe conflito de horÃ¡rio.

```javascript
import { hasAppointmentConflict } from "@/utils/appointments/hasConflict";

const appointments = [
  { date: "2026-01-15", time: "08:00" }
];

hasAppointmentConflict(appointments, "2026-01-15", "08:00");
// âžœ true (conflito!)

hasAppointmentConflict(appointments, "2026-01-15", "09:00");
// âžœ false (livre)
```

**Uso nos Hooks:**
- `useAvailability`
- `usePublicSchedule`

---

## ðŸ’¬ Helpers de Mensagens

### `generateWhatsappMessage(config)` âœ¨ NOVO
**Arquivo**: `src/utils/message/generateWhatsappMessage.js`

Gera mensagem formatada para WhatsApp.

```javascript
import { generateWhatsappMessage } from "@/utils/message/generateWhatsappMessage";

const message = generateWhatsappMessage({
  intro: "OlÃ¡",
  body: "Sua sessÃ£o estÃ¡ agendada",
  footer: "Nos vemos em breve",
  patientName: "JoÃ£o",
  date: "15/01/2026",
  time: "14:00",
  value: 150,
  showValue: true
});

// message contÃ©m a mensagem formatada
// âžœ "OlÃ¡ JoÃ£o
//    
//    Sua sessÃ£o estÃ¡ agendada
//    
//    Data: 15/01/2026
//    HorÃ¡rio: 14:00
//    Valor: R$ 150
//    
//    Nos vemos em breve"
```

**Config:**
```typescript
{
  intro?: string,           // Default: "OlÃ¡"
  body?: string,            // Default: "Sua sessÃ£o estÃ¡ agendada"
  footer?: string,          // Default: ""
  patientName?: string,     // Default: ""
  date?: string,            // DD/MM/YYYY
  time?: string,            // HH:mm
  value?: number,           // Default: 0
  showValue?: boolean       // Default: true
}
```

**Uso nos Hooks:**
- `useSettings` - Preview de mensagem

---

## ðŸ› ï¸ Helpers Gerais

### `generateYearRange(range)`
**Arquivo**: `src/utils/helpers/yearHelpers.js`

Gera lista de anos para seletores.

```javascript
import { generateYearRange } from "@/utils/helpers/yearHelpers";

// Assumindo ano atual = 2026

generateYearRange(1);
// âžœ [2027, 2026, 2025] (ordem decrescente)

generateYearRange(2);
// âžœ [2028, 2027, 2026, 2025, 2024]
```

**ParÃ¢metros:**
- `range` (number): Quantos anos antes e depois (padrÃ£o: 1)

**Retorna:** `Array<number>` - Anos em ordem decrescente

---
